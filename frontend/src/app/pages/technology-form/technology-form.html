<div class="technology-form">
  <a href="/" class="back-link">
    ‚Üê RETURN TO MAIN PAGE
  </a>

  <div class="form-container">
    <div class="form-header">
      <h1 class="form-title">{{ title() }}</h1>
    </div>

    @if (error()) {
      <div class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        {{ error() }}
      </div>
    }

    @if (isLoading()) {
      <app-spinner
        size="medium"
        message="Loading technology...">
      </app-spinner>
    } @else {
      <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form">
      <div class="form-field">
        <label for="name" class="field-label">Name</label>
        <input
          type="text"
          id="name"
          formControlName="name"
          class="form-input editable"
          [class.invalid]="isFieldInvalid('name')"
          placeholder="Enter technology name">
        @if (isFieldInvalid('name')) {
          <span class="field-error">{{ getFieldError('name') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="usage" class="field-label">Usage</label>
        <app-form-dropdown
          [options]="usageOptions"
          placeholder="Select usage type"
          [value]="form.get('usage')?.value || ''"
          [isInvalid]="isFieldInvalid('usage')"
          (valueChange)="form.get('usage')?.setValue($event)">
        </app-form-dropdown>
        @if (isFieldInvalid('usage')) {
          <span class="field-error">{{ getFieldError('usage') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="difficulty" class="field-label">Difficulty</label>
        <app-form-dropdown
          [options]="difficultyOptions"
          placeholder="Select difficulty level"
          [value]="form.get('difficulty')?.value || ''"
          [isInvalid]="isFieldInvalid('difficulty')"
          (valueChange)="form.get('difficulty')?.setValue($event)">
        </app-form-dropdown>
        @if (isFieldInvalid('difficulty')) {
          <span class="field-error">{{ getFieldError('difficulty') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="popularity" class="field-label">Popularity</label>
        <app-form-dropdown
          [options]="popularityOptions"
          placeholder="Select popularity level"
          [value]="form.get('popularity')?.value || ''"
          [isInvalid]="isFieldInvalid('popularity')"
          (valueChange)="form.get('popularity')?.setValue($event)">
        </app-form-dropdown>
        @if (isFieldInvalid('popularity')) {
          <span class="field-error">{{ getFieldError('popularity') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="firstRelease" class="field-label">First Release</label>
        <input
          type="number"
          id="firstRelease"
          formControlName="firstRelease"
          class="form-input"
          [class.invalid]="isFieldInvalid('firstRelease')"
          min="1990"
          [max]="currentYear"
          placeholder="Enter release year">
        @if (isFieldInvalid('firstRelease')) {
          <span class="field-error">{{ getFieldError('firstRelease') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="typescript" class="field-label">Typescript</label>
        <app-form-dropdown
          [options]="typescriptOptions"
          placeholder="Select TypeScript support"
          [value]="form.get('typescript')?.value || ''"
          [isInvalid]="isFieldInvalid('typescript')"
          (valueChange)="form.get('typescript')?.setValue($event)">
        </app-form-dropdown>
        @if (isFieldInvalid('typescript')) {
          <span class="field-error">{{ getFieldError('typescript') }}</span>
        }
      </div>

      <div class="form-field">
        <label for="description" class="field-label">Description</label>
        <textarea
          id="description"
          formControlName="description"
          class="form-textarea"
          [class.invalid]="isFieldInvalid('description')"
          rows="4"
          placeholder="Enter technology description"></textarea>
        @if (isFieldInvalid('description')) {
          <span class="field-error">{{ getFieldError('description') }}</span>
        }
      </div>

      <div class="form-actions">
        @if (mode() === 'edit') {
          <button
            type="button"
            class="btn btn-delete"
            (click)="onDelete()"
            [disabled]="isSubmitting()">
            Delete
          </button>
        }
        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="isSubmitting() || form.invalid">
          @if (isSubmitting()) {
            <i class="fas fa-spinner fa-spin"></i>
            {{ mode() === 'create' ? 'Creating...' : 'Updating...' }}
          } @else {
            {{ mode() === 'create' ? 'Create' : 'Update' }}
          }
        </button>
      </div>
    </form>
    }
  </div>

  <app-confirm-delete-modal
    [isOpen]="showDeleteModal()"
    [isLoading]="isSubmitting()"
    title="Delete Technology"
    message="Are you sure you want to delete this technology? This action cannot be undone."
    [itemName]="form.get('name')?.value || ''"
    (confirm)="onDeleteConfirm()"
    (cancel)="onDeleteCancel()">
  </app-confirm-delete-modal>
</div>
